import{r as c,j as e,B as m,ag as U,f as F,h as E,i as T,k as A,M as P}from"./index-B5pvZNP2.js";import"./Banners-BeAAoNOy.js";import{u as R}from"./useCountdown-DsfdJN4g.js";const _=({deal:n,onClose:r,onUpdate:p})=>{const i=(t=>{const s={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0};return t.toLocaleString("en-US",s).replace(",","")})(new Date),[d,u]=c.useState({name:n.name||"",offer:n.offer||"",link:n.link||"",day:n.day||"",video:n.video||"",image:n.image||"",updateDate:i}),[h,g]=c.useState(null),[y,b]=c.useState(null),o=t=>{const{name:s,value:l}=t.target;u({...d,[s]:l})},w=t=>{g(t.target.files[0])},v=t=>{b(t.target.files[0])},f=(t,s)=>new Promise((l,j)=>{if(!t){l(null);return}const C=U(),k=F(C,`deals/${s}/${t.name}`),S=E(k,t);S.on("state_changed",x=>{},x=>{j(x)},()=>{T(S.snapshot.ref).then(x=>{l(x)}).catch(x=>{j(x)})})}),a=async t=>{t.preventDefault();try{const s=await f(h,"images"),l=await f(y,"videos"),j={...d,...s&&{image:s},...l&&{video:l}};await p(n._id,j),r()}catch(s){m.error("Failed to update deal."),console.error("Error updating deal:",s)}};return e.jsx("section",{className:"fixed inset-0 flex justify-center items-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg w-[90%] max-w-2xl",children:[e.jsx("h2",{className:"text-xl mb-4 font-semibold",children:"Update deal"}),e.jsxs("form",{className:" text-sm",onSubmit:a,children:[e.jsxs("div",{className:"flex flex-col items-center gap-3 my-3 w-full",children:[e.jsxs("div",{className:"flex w-full gap-4",children:[e.jsx("div",{className:"w-full",children:e.jsx("input",{type:"text",name:"name",value:d.name,onChange:o,placeholder:"Name",className:"w-full p-3 px-5 border rounded-full input-field"})}),e.jsx("div",{className:"w-full",children:e.jsx("input",{type:"text",name:"offer",value:d.offer,onChange:o,placeholder:"Deal Offer",className:"w-full p-3 px-5 border rounded-full input-field"})})]}),e.jsxs("div",{className:"flex w-full gap-4",children:[e.jsx("div",{className:"w-full",children:e.jsx("input",{type:"text",name:"link",value:d.link,onChange:o,placeholder:"Deal Product Link",className:"w-full p-3 px-5 border rounded-full input-field"})}),e.jsx("div",{className:"w-full",children:e.jsx("input",{type:"number",name:"day",value:d.day,onChange:o,placeholder:"Deal Day",className:"w-full p-3 px-5 border rounded-full input-field"})})]}),e.jsxs("div",{className:"flex w-full gap-4",children:[e.jsxs("div",{className:"w-full space-y-1",children:[e.jsx("label",{htmlFor:"video",className:"text-sm ml-2",children:"Deal Video"}),e.jsx("input",{type:"file",name:"video",id:"video",onChange:v,placeholder:"Upload Video",className:"w-full p-3 px-5 border rounded-full input-field"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{htmlFor:"image",className:"text-sm ml-2",children:"Deal Photo"}),e.jsx("input",{type:"file",name:"image",id:"image",onChange:w,placeholder:"Upload Image",className:"w-full p-3 px-5 border rounded-full input-field"})]})]})]}),e.jsxs("div",{className:"w-full flex justify-end items-center gap-3",children:[e.jsx("button",{type:"button",className:"bg-[#1d1e29] hover:bg-black text-white px-7 py-2.5 rounded-full font-semibold transition-all",onClick:r,children:"Cancel"}),e.jsx("button",{type:"submit",className:"bg-[#ff5a00] hover:bg-orange-600 text-white px-5 py-2.5 rounded-full font-semibold transition-all",children:"Update Product"})]})]})]})})},O=({fetchNewDeal:n})=>{const[r,p]=c.useState([]),[D,N]=c.useState(null),i=A(),[d,u]=c.useState(!1),[h,g]=c.useState(null);c.useEffect(()=>{(async()=>{var t,s;try{const l=await i.get("/deal");p(l.data),N((s=(t=l.data)==null?void 0:t[0])==null?void 0:s.endTime)}catch(l){console.error("Error fetching Deal:",l),m.error("Failed to load Deal.")}})()},[i]);const y=async(a,t)=>{try{await i.put(`/deal/${a}`,t),p(r.map(s=>s._id===a?{...t,_id:a}:s)),m.success("Deal updated successfully!"),u(!1)}catch(s){m.error("Failed to update deal."),console.error("Error updating deal:",s)}},{days:b,hours:o,minutes:w,seconds:v}=R(D,n),f=async a=>{var t;try{const s=new Date(Date.now()+((t=r==null?void 0:r[0])==null?void 0:t.day)*24*60*60*1e3).toISOString();(await i.put(`/deal/${a}`,{endTime:s})).data&&(N(s),n(),m.success("Countdown reset successfully!"))}catch(s){console.error("Error resetting deal time:",s),m.success("Countdown reset successfully!")}};return e.jsxs("section",{className:"text-sm",children:[e.jsxs("div",{className:"p-[1rem]",children:[e.jsx("h2",{className:"font-semibold",children:"Hot Deal:"}),r.length>0?e.jsxs("div",{className:"lg:overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full table-auto border-collapse",children:[e.jsx("thead",{className:"bg-slate-50 shadow-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-start",children:"Video"}),e.jsx("th",{className:"px-4 py-2 text-start",children:"Image"}),e.jsx("th",{className:"px-4 py-2 text-start hidden md:table-cell",children:"Name"}),e.jsx("th",{className:"px-4 py-2 text-start hidden md:table-cell",children:"Offer"}),e.jsx("th",{className:"px-4 py-2 text-start hidden md:table-cell",children:"Last Update"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Link"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Day"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Edit"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Reset"})]})}),e.jsx("tbody",{children:r.map((a,t)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-4 py-2 flex items-center gap-2",children:[t+1,"."," ",e.jsx("video",{src:a.video,autoPlay:!0,loop:!0,muted:!0,className:"w-16 md:w-32 h-16 rounded object-fill"})]}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("img",{src:a.image,alt:"deal",className:"w-16 md:w-32 h-16 rounded object-fill"})}),e.jsx("td",{className:"px-4 py-2 text-start hidden md:table-cell",children:a.name||"N/A"}),e.jsx("td",{className:"px-4 py-2 text-start hidden md:table-cell",children:a.offer||"N/A"}),e.jsx("td",{className:"px-4 py-2 text-start hidden md:table-cell",children:a.updateDate||"N/A"}),e.jsx("td",{className:"px-4 py-2 text-start",children:a.link?e.jsx("a",{href:a.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Link"}):"N/A"}),e.jsx("td",{className:"px-4 py-2 text-center",children:a.day||"N/A"}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("button",{className:"bg-slate-100 hover:bg-[#1e1d29] hover:text-white transition-all shadow-md p-3.5 rounded-full flex items-center justify-center",onClick:()=>{g(a),u(!0)},children:e.jsx(P,{})})}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("button",{className:"w-fit bg-[#1e1f29] hover:bg-[#ff5a00] text-white text-sm font-semibold py-2 px-4 rounded-full transition-all",onClick:()=>f(a._id),children:"Reset"})})]},a._id))})]}),e.jsx("div",{className:"mt-5",children:e.jsxs("div",{className:"flex justify-center space-x-3",children:[e.jsxs("div",{className:"text-white bg-[#ff5a00] text-center rounded-full py-2 px-3",children:[e.jsx("h3",{className:"text-2xl font-bold",children:b}),e.jsx("p",{className:"text-xs",children:"DAYS"})]}),e.jsxs("div",{className:"text-white bg-[#ff5a00] text-center rounded-full py-2 px-3",children:[e.jsx("h3",{className:"text-2xl font-bold",children:o}),e.jsx("p",{className:"text-xs",children:"HOURS"})]}),e.jsxs("div",{className:"text-white bg-[#ff5a00] text-center rounded-full py-2 px-3",children:[e.jsx("h3",{className:"text-2xl font-bold",children:w}),e.jsx("p",{className:"text-xs",children:"MINS"})]}),e.jsxs("div",{className:"text-white bg-[#ff5a00] text-center rounded-full py-2 px-3",children:[e.jsx("h3",{className:"text-2xl font-bold",children:v}),e.jsx("p",{className:"text-xs",children:"SECS"})]})]})})]}):e.jsx("p",{children:"No deal available"})]}),d&&h&&e.jsx(_,{deal:h,onClose:()=>u(!1),onUpdate:y})]})};export{O as default};
